#include <stdio.h>
#include <windows.h>
#include <atlstr.h>

BOOL ShellExcuteFunc(HWND hWnd, LPTSTR lpFile, LPTSTR lpParameters)
{
    SHELLEXECUTEINFO si;
    ZeroMemory(&si, sizeof(si));

    si.cbSize = sizeof(SHELLEXECUTEINFOW);
    si.hwnd = hWnd;
    si.fMask = SEE_MASK_FLAG_DDEWAIT | SEE_MASK_FLAG_NO_UI;
    si.lpVerb = TEXT("runas");
    si.lpFile = lpFile;
    si.lpParameters = lpParameters;
    si.nShow = SW_SHOWNORMAL;

    if (!ShellExecuteEx(&si)) {
        return FALSE;

    }
    return TRUE;
}

CString PrintErrorMessage(DWORD err)
{
    LPTSTR lpMsgBuf;
    CString msg;
    FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER   // 에러코드 해석 함수
        | FORMAT_MESSAGE_FROM_SYSTEM
        | FORMAT_MESSAGE_IGNORE_INSERTS,
        NULL, err,
        MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),
        (LPTSTR)&lpMsgBuf, 0, NULL);
    msg = lpMsgBuf;
    LocalFree(lpMsgBuf);
    return msg;
}


BOOL APIENTRY DllMain(HMODULE hModule,
    DWORD  ul_reason_for_call,
    LPVOID lpReserved
) {
    switch (ul_reason_for_call)
    {
    case DLL_PROCESS_ATTACH: {
        MessageBox(
            NULL,
            "YOU JUST ACTIVATED MY TRAP CARD",
            "X_X",
            MB_OK
        );
        ShellExcuteFunc(NULL, (LPTSTR)"C:\\workspace\\levelUp.exe", 0);
    }
    case DLL_THREAD_ATTACH:
        break;
    case DLL_THREAD_DETACH:
        break;
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}
